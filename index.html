<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APAC Finance Leadership - Ask Me Anything (AMA)</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .card {
            background-color: #2a2a2a;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            overflow: hidden;
        }
        .btn-primary {
            background-color: #e31837;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-primary:hover {
            background-color: #c01530;
        }
        .btn-secondary {
            background-color: #343434;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-secondary:hover {
            background-color: #444444;
        }
        .btn-danger {
            background-color: #b91c1c;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-danger:hover {
            background-color: #991b1b;
        }
        .btn-success {
            background-color: #1b7e1e;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-success:hover {
            background-color: #166118;
        }
        .form-input, .form-select, .form-textarea {
            background-color: #343434;
            color: #e0e0e0;
            border: 1px solid #444444;
            border-radius: 4px;
            padding: 8px 12px;
            width: 100%;
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #e0e0e0;
        }
        .badge {
            background-color: #444444;
            color: #e0e0e0;
            border-radius: 20px;
            padding: 4px 10px;
            font-size: 0.8rem;
            display: inline-block;
            margin-right: 6px;
        }
        .badge-benefits { background-color: #4CAF50; color: white; }
        .badge-compensation { background-color: #2196F3; color: white; }
        .badge-strategy { background-color: #9C27B0; color: white; }
        .badge-others { background-color: #FF9800; color: white; }
        .upvote-btn {
            background-color: transparent;
            border: none;
            color: #e0e0e0;
            cursor: pointer;
            transition: color 0.3s;
        }
        .upvote-btn:hover {
            color: #e31837;
        }
        .upvoted {
            color: #e31837;
        }
        .admin-controls {
            display: none;
        }
        .logo-container {
            max-width: 180px;
            margin-right: 20px;
        }
        .tab-active {
            border-bottom: 3px solid #e31837;
            font-weight: 600;
        }
        .question-card {
            transition: transform 0.3s;
        }
        .question-card:hover {
            transform: translateY(-3px);
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        .modal-content {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .ch-red {
            color: #e31837;
        }
        .bg-ch-red {
            background-color: #e31837;
        }
        .timestamp {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 4px;
        }
        .update-card {
            border-left: 3px solid #e31837;
            padding-left: 16px;
            margin-bottom: 24px;
        }
        .update-content {
            white-space: pre-line;
        }
        .info-box {
            background-color: rgba(66, 153, 225, 0.1);
            border-left: 4px solid #4299e1;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        .warning-box {
            background-color: rgba(237, 137, 54, 0.1);
            border-left: 4px solid #ed8936;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        .success-box {
            background-color: rgba(72, 187, 120, 0.1);
            border-left: 4px solid #48bb78;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        .error-box {
            background-color: rgba(245, 101, 101, 0.1);
            border-left: 4px solid #f56565;
            padding: 12px 16px;
            margin-bottom: 16px;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background-color: #e31837;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 8px;
        }
        code {
            background-color: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
        .email-preview {
            background-color: #f5f5f5;
            color: #333;
            border-radius: 4px;
            padding: 12px;
            font-family: Arial, sans-serif;
            margin-bottom: 16px;
        }
        .email-preview-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            margin-bottom: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container py-6">
        <!-- Header with Logo -->
        <div class="flex flex-col md:flex-row items-center mb-8">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/C._H._Robinson_logo.svg/1280px-C._H._Robinson_logo.svg.png" alt="CH Robinson Logo" class="w-full">
            </div>
            <div class="text-center md:text-left mt-4 md:mt-0">
                <h1 class="text-3xl font-bold text-white">APAC Finance Leadership - Ask Me Anything (AMA)</h1>
            </div>
            <div class="ml-auto mt-4 md:mt-0">
                <button id="adminLoginBtn" class="btn-secondary"><i class="fas fa-lock mr-2"></i>Admin Login</button>
                <button id="adminLogoutBtn" class="btn-secondary" style="display: none;"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex border-b border-gray-700 mb-6 overflow-x-auto">
            <button id="tabAllQuestions" class="px-4 py-2 text-lg tab-active">All Questions</button>
            <button id="tabLeadershipUpdates" class="px-4 py-2 text-lg">Leadership Updates</button>
            <button id="tabSubmitQuestion" class="px-4 py-2 text-lg">Submit a Question</button>
            <div id="adminTabs" style="display: none;">
                <button id="tabAdminPanel" class="px-4 py-2 text-lg">Admin Panel</button>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div id="searchFilterBar" class="mb-6 flex flex-col md:flex-row items-center">
            <div class="w-full md:w-1/2 mb-4 md:mb-0">
                <input type="text" id="searchInput" placeholder="Search questions..." class="form-input">
            </div>
            <div class="w-full md:w-1/2 md:pl-4 flex">
                <div class="w-full">
                    <select id="topicFilter" class="form-select">
                        <option value="all">All Topics</option>
                        <option value="benefits">Employee Benefits</option>
                        <option value="compensation">Compensation</option>
                        <option value="strategy">Strategy & Direction</option>
                        <option value="others">Others</option>
                    </select>
                </div>
                <div class="ml-2">
                    <select id="sortFilter" class="form-select">
                        <option value="latest">Latest</option>
                        <option value="popular">Most Upvoted</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Questions List Container -->
        <div id="questionsContainer" class="mb-8">
            <!-- Questions will be populated here by JavaScript -->
            <div class="text-center py-16">
                <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                <p>Loading questions...</p>
            </div>
        </div>

        <!-- Leadership Updates Container -->
        <div id="leadershipUpdatesContainer" class="mb-8" style="display: none;">
            <div class="card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Leadership Updates</h2>
                    <button id="addUpdateBtn" class="btn-primary admin-controls" style="display: none;">
                        <i class="fas fa-plus mr-2"></i>Add Update
                    </button>
                </div>
                
                <div id="updatesContent" class="space-y-6">
                    <!-- Updates will be populated here by JavaScript -->
                    <div class="text-center py-8">
                        <i class="fas fa-info-circle text-4xl mb-4 text-gray-500"></i>
                        <p class="text-gray-400">No updates available yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Question Form - Initially Hidden -->
        <div id="submitQuestionForm" class="card p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Submit Your Question</h2>
            <form id="questionForm">
                <div class="mb-4">
                    <label class="form-label" for="questionTitle">Question Title</label>
                    <input type="text" id="questionTitle" class="form-input" placeholder="Brief title of your question" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="questionContent">Question Details</label>
                    <textarea id="questionContent" class="form-textarea" rows="4" placeholder="Provide details about your question..." required></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="questionTopic">Topic</label>
                    <select id="questionTopic" class="form-select" required>
                        <option value="">-- Select a Topic --</option>
                        <option value="benefits">Employee Benefits</option>
                        <option value="compensation">Compensation</option>
                        <option value="strategy">Strategy & Direction</option>
                        <option value="others">Others</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="submitterName">Your Name (Optional)</label>
                    <input type="text" id="submitterName" class="form-input" placeholder="Leave blank to remain anonymous">
                    <p class="text-sm text-gray-400 mt-1">If left blank, your question will be posted anonymously.</p>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="submitterEmail">Your Email (Optional)</label>
                    <input type="email" id="submitterEmail" class="form-input" placeholder="For notification when answered (not displayed publicly)">
                    <p class="text-sm text-gray-400 mt-1">We'll notify you when your question is answered. Your email will not be shared.</p>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" class="btn-primary"><i class="fas fa-paper-plane mr-2"></i>Submit Question</button>
                </div>
            </form>
        </div>

        <!-- Admin Panel - Initially Hidden -->
        <div id="adminPanel" class="card p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Admin Panel</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Pending Questions</h3>
                <div id="pendingQuestionsContainer" class="space-y-4">
                    <!-- Pending questions will be populated here -->
                    <p class="text-gray-400">No pending questions.</p>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Email Notification Settings</h3>
                <div class="card p-4 bg-gray-800 mb-4">
                    <div class="success-box mb-4">
                        <h4 class="font-bold mb-2"><i class="fas fa-check-circle mr-2"></i>Email Notifications Configured</h4>
                        <p>Email notifications are set up to notify:</p>
                        <ul class="list-disc ml-6 mt-2">
                            <li><strong>Admin (james.neo@chrobinson.com)</strong> when new questions are submitted</li>
                            <li><strong>Employees</strong> when their questions receive answers (if they provided an email)</li>
                        </ul>
                    </div>
                    
                    <p class="mb-2">The system uses a pre-configured EmailJS service that doesn't require any setup on your part.</p>
                    
                    <div class="flex mb-4">
                        <button id="testEmailBtn" class="btn-primary mr-2">
                            <i class="fas fa-paper-plane mr-1"></i> Test Email System
                        </button>
                        <button id="viewEmailPreviewBtn" class="btn-secondary">
                            <i class="fas fa-eye mr-1"></i> View Email Preview
                        </button>
                    </div>
                    
                    <div id="emailStatusIndicator" class="info-box">
                        <p><i class="fas fa-info-circle mr-2"></i>Email system status: <span id="emailStatus">Ready</span></p>
                    </div>
                </div>
                
                <div class="card p-4 bg-gray-800">
                    <h4 class="font-bold mb-3">Email Troubleshooting</h4>
                    
                    <div class="accordion">
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 bg-gray-700 rounded">
                                <span class="font-semibold">If Email Notifications Aren't Working</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 bg-gray-800 rounded-b">
                                <p class="mb-3">If the automatic email system isn't working, here are some troubleshooting steps:</p>
                                
                                <div class="mb-3">
                                    <span class="step-number">1</span>
                                    <span>Test connectivity by clicking the "Test Email System" button above</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">2</span>
                                    <span>Check if your network blocks API calls to external services</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">3</span>
                                    <span>Verify the admin email is correct (currently: james.neo@chrobinson.com)</span>
                                </div>
                                
                                <div class="warning-box mt-4">
                                    <h5 class="font-bold mb-2">Fallback Option</h5>
                                    <p>If automatic emails aren't working, the system will automatically try to open your default email client as a fallback method.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 bg-gray-700 rounded">
                                <span class="font-semibold">Manual Email Alternative</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 bg-gray-800 rounded-b">
                                <p class="mb-3">If the automatic methods fail, you can use these manual email links:</p>
                                
                                <div class="mb-3">
                                    <a href="#" id="manualAdminEmailLink" class="text-blue-400 underline">
                                        <i class="fas fa-envelope mr-1"></i> Open email to notify admin of new question
                                    </a>
                                </div>
                                
                                <div class="mb-3">
                                    <a href="#" id="manualEmployeeEmailLink" class="text-blue-400 underline">
                                        <i class="fas fa-envelope mr-1"></i> Open email to notify employee of response
                                    </a>
                                </div>
                                
                                <p class="text-sm text-gray-400 mt-3">These links will open your default email application with pre-filled information.</p>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 bg-gray-700 rounded">
                                <span class="font-semibold">Technical Details</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 bg-gray-800 rounded-b">
                                <p class="mb-3">This system uses EmailJS with a public key that doesn't require any account setup.</p>
                                
                                <p class="mb-3">Email flow:</p>
                                <ol class="list-decimal ml-6 mb-4">
                                    <li>Question submitted → Email sent to james.neo@chrobinson.com</li>
                                    <li>Admin responds → Email sent to employee's email (if provided)</li>
                                </ol>
                                
                                <p class="mb-2">In case of errors, check the console for specific error messages.</p>
                                
                                <div class="info-box">
                                    <p><i class="fas fa-info-circle mr-2"></i>The email system uses a 100 emails/month limit, which should be sufficient for normal use.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Admin Security</h3>
                <div class="card p-4 bg-gray-800">
                    <div class="mb-4">
                        <label class="form-label" for="adminPassword">Change Admin Password</label>
                        <input type="password" id="adminPassword" class="form-input" placeholder="Enter new admin password">
                    </div>
                    
                    <button id="saveAdminPassword" class="btn-primary">Update Password</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Admin Login -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Admin Login</h2>
            <form id="adminLoginForm">
                <div class="mb-4">
                    <label class="form-label" for="adminLoginPassword">Password</label>
                    <input type="password" id="adminLoginPassword" class="form-input" placeholder="Enter admin password" required>
                </div>
                
                <div class="flex justify-end">
                    <button type="button" class="btn-secondary mr-2" id="cancelAdminLogin">Cancel</button>
                    <button type="submit" class="btn-primary">Login</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Responding to Questions -->
    <div id="responseModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Respond to Question</h2>
            <div id="responseQuestionDetails" class="mb-4 pb-4 border-b border-gray-700"></div>
            
            <form id="responseForm">
                <input type="hidden" id="responseQuestionId">
                
                <div class="mb-4">
                    <label class="form-label" for="responseContent">Your Response</label>
                    <textarea id="responseContent" class="form-textarea" rows="4" placeholder="Type your response..." required></textarea>
                </div>
                
                <div id="responseEmailInfo" class="mb-4 info-box">
                    <p>Notification will be sent to: <span id="responseEmailAddress">No email provided</span></p>
                </div>
                
                <div class="flex justify-end">
                    <button type="button" class="btn-secondary mr-2" id="cancelResponse">Cancel</button>
                    <button type="submit" class="btn-primary">Submit Response</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Adding Leadership Updates -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Add Leadership Update</h2>
            
            <form id="updateForm">
                <div class="mb-4">
                    <label class="form-label" for="updateTitle">Update Title</label>
                    <input type="text" id="updateTitle" class="form-input" placeholder="Title of your update" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="updateContent">Update Content</label>
                    <textarea id="updateContent" class="form-textarea" rows="6" placeholder="Share your update with the team..." required></textarea>
                </div>
                
                <div class="flex justify-end">
                    <button type="button" class="btn-secondary mr-2" id="cancelUpdate">Cancel</button>
                    <button type="submit" class="btn-primary">Publish Update</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Deleting Questions -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Delete Question</h2>
            <p class="mb-6">Are you sure you want to delete this question? This action cannot be undone.</p>
            
            <div id="deleteQuestionDetails" class="mb-4 pb-4 border-b border-gray-700 text-gray-400"></div>
            
            <input type="hidden" id="deleteQuestionId">
            
            <div class="flex justify-end mt-6">
                <button type="button" class="btn-secondary mr-2" id="cancelDelete">Cancel</button>
                <button type="button" class="btn-danger" id="confirmDelete">Delete Question</button>
            </div>
        </div>
    </div>

    <!-- Email Preview Modal -->
    <div id="emailPreviewModal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Email Preview</h2>
            
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">New Question Notification (to Admin)</h3>
                <div class="email-preview">
                    <div class="email-preview-header">
                        <div>To: james.neo@chrobinson.com</div>
                        <div>Subject: New Question Submitted - APAC Finance Leadership AMA</div>
                    </div>
                    <div class="mt-3">
                        <p>A new question has been submitted in the APAC Finance Leadership AMA portal:</p>
                        <p class="mt-2"><strong>Title:</strong> [Question Title]</p>
                        <p><strong>Topic:</strong> [Topic]</p>
                        <p><strong>Submitted by:</strong> [Name]</p>
                        <p class="mt-2"><strong>Question:</strong></p>
                        <p>[Question Content]</p>
                        <p class="mt-3">Please log in to the AMA portal to respond.</p>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Response Notification (to Employee)</h3>
                <div class="email-preview">
                    <div class="email-preview-header">
                        <div>To: [Employee Email]</div>
                        <div>Subject: Your Question Has Been Answered - APAC Finance Leadership AMA</div>
                    </div>
                    <div class="mt-3">
                        <p>Your question in the APAC Finance Leadership AMA portal has received a response:</p>
                        <p class="mt-2"><strong>Your Question:</strong> [Question Title]</p>
                        <p class="mt-2"><strong>Response:</strong></p>
                        <p>[Response Content]</p>
                        <p class="mt-3">You can view the full response and other questions in the AMA portal.</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end mt-4">
                <button id="closeEmailPreview" class="btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 px-4 py-2 rounded-lg bg-gray-800 text-white shadow-lg transform transition-transform duration-300 translate-y-20 opacity-0">
        <span id="toastMessage">Notification message</span>
    </div>

    <script>
        // Global variables and state
        let questions = [];
        let leadershipUpdates = [];
        let isAdmin = false;
        const defaultAdminPassword = 'admin123';
        const adminEmail = 'james.neo@chrobinson.com';
        
        // EmailJS configuration
        const emailjsPublicKey = 'user_XJITM5hkJQMsS1I2CfDjI'; // Public demo key
        const emailjsServiceId = 'service_b6kktlp'; // Public demo service
        const emailjsTemplateId = 'template_6ggr87c'; // Public demo template

        // Initialize EmailJS
        (function() {
            emailjs.init(emailjsPublicKey);
        })();

        // DOM Elements
        const questionsContainer = document.getElementById('questionsContainer');
        const leadershipUpdatesContainer = document.getElementById('leadershipUpdatesContainer');
        const updatesContent = document.getElementById('updatesContent');
        const submitQuestionForm = document.getElementById('submitQuestionForm');
        const adminPanel = document.getElementById('adminPanel');
        const adminTabs = document.getElementById('adminTabs');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminLogoutBtn = document.getElementById('adminLogoutBtn');
        const adminLoginModal = document.getElementById('adminLoginModal');
        const responseModal = document.getElementById('responseModal');
        const updateModal = document.getElementById('updateModal');
        const deleteModal = document.getElementById('deleteModal');
        const emailPreviewModal = document.getElementById('emailPreviewModal');
        const toast = document.getElementById('toast');

        // Initialize app on load
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            setupAccordion();
        });

        // App initialization
        function initializeApp() {
            loadDataFromLocalStorage();
            displayQuestions();
            displayLeadershipUpdates();
            updateAdminUI();
        }

        // Load data from localStorage
        function loadDataFromLocalStorage() {
            try {
                // Load questions
                const savedQuestions = localStorage.getItem('amaQuestions');
                if (savedQuestions) {
                    questions = JSON.parse(savedQuestions);
                } else {
                    // Sample questions for first-time users
                    questions = [
                        {
                            id: 'q1',
                            title: 'When will the next salary review happen?',
                            content: 'I was wondering about the timeline for the next salary review cycle.',
                            topic: 'compensation',
                            submitter: 'Anonymous',
                            email: '',
                            date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                            upvotes: 12,
                            upvotedBy: [],
                            response: 'The next salary review will happen in April 2023. We will communicate the exact dates as we get closer to the review period.',
                            responseDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            id: 'q2',
                            title: 'Are there plans to expand our team in APAC?',
                            content: 'I\'ve noticed increased workload and was wondering if there are plans to hire more people in the Finance department.',
                            topic: 'strategy',
                            submitter: 'Jane Smith',
                            email: '',
                            date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                            upvotes: 8,
                            upvotedBy: [],
                            response: '',
                            responseDate: ''
                        },
                        {
                            id: 'q3',
                            title: 'Can we get more information about the flexible benefits package?',
                            content: 'I would like to understand how we can best utilize the flexible benefits offered by the company.',
                            topic: 'benefits',
                            submitter: 'Anonymous',
                            email: '',
                            date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                            upvotes: 15,
                            upvotedBy: [],
                            response: 'Great question! We will be hosting an information session about flexible benefits on June 15th. Details will be sent via email next week.',
                            responseDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                        }
                    ];
                    saveQuestionsToLocalStorage();
                }

                // Load leadership updates
                const savedUpdates = localStorage.getItem('amaLeadershipUpdates');
                if (savedUpdates) {
                    leadershipUpdates = JSON.parse(savedUpdates);
                } else {
                    // Sample leadership update for first-time users
                    leadershipUpdates = [
                        {
                            id: 'u1',
                            title: 'Q2 Financial Results',
                            content: 'We are pleased to announce that our Q2 financial results exceeded expectations. The Finance team has done an exceptional job managing costs while supporting business growth. \n\nThank you for your continued dedication and hard work.',
                            date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
                        }
                    ];
                    saveUpdatesToLocalStorage();
                }

                // Load admin settings
                const savedAdminPassword = localStorage.getItem('amaAdminPassword');
                if (savedAdminPassword) {
                    adminPassword = savedAdminPassword;
                } else {
                    localStorage.setItem('amaAdminPassword', defaultAdminPassword);
                }
            } catch (error) {
                console.error('Error loading data from localStorage:', error);
                showToast('Error loading data. Starting with empty state.', 'error');
                questions = [];
                leadershipUpdates = [];
            }
        }

        // Save questions to localStorage
        function saveQuestionsToLocalStorage() {
            try {
                localStorage.setItem('amaQuestions', JSON.stringify(questions));
            } catch (error) {
                console.error('Error saving questions to localStorage:', error);
                showToast('Error saving question data.', 'error');
            }
        }

        // Save leadership updates to localStorage
        function saveUpdatesToLocalStorage() {
            try {
                localStorage.setItem('amaLeadershipUpdates', JSON.stringify(leadershipUpdates));
            } catch (error) {
                console.error('Error saving updates to localStorage:', error);
                showToast('Error saving leadership updates.', 'error');
            }
        }

        // Display questions in the container
        function displayQuestions() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const topicFilter = document.getElementById('topicFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;
            
            // Filter questions based on search and topic
            let filteredQuestions = questions.filter(question => {
                const matchesSearch = 
                    question.title.toLowerCase().includes(searchTerm) || 
                    question.content.toLowerCase().includes(searchTerm);
                
                const matchesTopic = topicFilter === 'all' || question.topic === topicFilter;
                
                return matchesSearch && matchesTopic;
            });
            
            // Sort questions
            if (sortFilter === 'popular') {
                filteredQuestions.sort((a, b) => b.upvotes - a.upvotes);
            } else {
                filteredQuestions.sort((a, b) => new Date(b.date) - new Date(a.date));
            }
            
            // Render the HTML
            if (filteredQuestions.length === 0) {
                questionsContainer.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-search text-4xl mb-4 text-gray-500"></i>
                        <p class="text-gray-400">No questions found. Try adjusting your filters or be the first to ask!</p>
                    </div>
                `;
                return;
            }
            
            questionsContainer.innerHTML = filteredQuestions.map(question => {
                const topicClass = `badge-${question.topic}`;
                const topicText = {
                    'benefits': 'Employee Benefits',
                    'compensation': 'Compensation',
                    'strategy': 'Strategy & Direction',
                    'others': 'Others'
                }[question.topic] || question.topic;
                
                const date = new Date(question.date);
                const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                
                const adminControls = isAdmin ? `
                    <div class="flex space-x-2 mt-2">
                        ${!question.response ? `
                            <button class="btn-primary respond-btn" data-id="${question.id}">
                                <i class="fas fa-reply mr-1"></i> Respond
                            </button>
                        ` : `
                            <button class="btn-secondary respond-btn" data-id="${question.id}">
                                <i class="fas fa-edit mr-1"></i> Edit Response
                            </button>
                        `}
                        <button class="btn-danger delete-btn" data-id="${question.id}">
                            <i class="fas fa-trash-alt mr-1"></i> Delete
                        </button>
                    </div>
                ` : '';
                
                return `
                <div class="card question-card p-4 mb-4" data-id="${question.id}">
                    <div class="flex items-start">
                        <div class="mr-4 text-center">
                            <button class="upvote-btn flex flex-col items-center ${question.upvotedBy.includes(getClientId()) ? 'upvoted' : ''}" data-id="${question.id}">
                                <i class="fas fa-chevron-up text-xl"></i>
                                <span class="text-lg font-semibold">${question.upvotes}</span>
                            </button>
                        </div>
                        
                        <div class="flex-1">
                            <h3 class="text-xl font-bold mb-2">${escapeHtml(question.title)}</h3>
                            
                            <div class="flex flex-wrap items-center mb-3">
                                <span class="badge ${topicClass} mr-2">${topicText}</span>
                                <span class="text-gray-400 text-sm">
                                    Asked by ${escapeHtml(question.submitter)} on ${formattedDate}
                                </span>
                            </div>
                            
                            <div class="mb-4 whitespace-pre-line">${escapeHtml(question.content)}</div>
                            
                            ${question.response ? `
                            <div class="mt-4 border-t border-gray-700 pt-4">
                                <h4 class="font-semibold text-green-400 mb-2">Response:</h4>
                                <div class="whitespace-pre-line">${escapeHtml(question.response)}</div>
                                <div class="text-gray-400 text-sm mt-2">
                                    Answered on ${new Date(question.responseDate).toLocaleDateString()}
                                </div>
                            </div>
                            ${isAdmin ? adminControls : ''}
                            ` : (isAdmin ? adminControls : `
                            <div class="mt-4 text-gray-400 italic">
                                <i class="fas fa-hourglass-half mr-1"></i> Awaiting response
                            </div>
                            `)}
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            // Add event listeners to upvote buttons
            document.querySelectorAll('.upvote-btn').forEach(button => {
                button.addEventListener('click', handleUpvote);
            });
            
            // Add event listeners to admin buttons (for admin)
            if (isAdmin) {
                document.querySelectorAll('.respond-btn').forEach(button => {
                    button.addEventListener('click', openResponseModal);
                });
                
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', openDeleteModal);
                });
            }
        }

        // Display leadership updates
        function displayLeadershipUpdates() {
            if (leadershipUpdates.length === 0) {
                updatesContent.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-info-circle text-4xl mb-4 text-gray-500"></i>
                        <p class="text-gray-400">No updates available yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort updates by date (newest first)
            const sortedUpdates = [...leadershipUpdates].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            updatesContent.innerHTML = sortedUpdates.map(update => {
                const date = new Date(update.date);
                const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                
                return `
                <div class="update-card">
                    <div class="timestamp">Posted on ${formattedDate}</div>
                    <h3 class="text-xl font-bold mb-2">${escapeHtml(update.title)}</h3>
                    <div class="update-content">${escapeHtml(update.content)}</div>
                </div>
                `;
            }).join('');
        }

        // Handle upvoting a question
        function handleUpvote(e) {
            const questionId = e.currentTarget.getAttribute('data-id');
            const clientId = getClientId();
            
            const questionIndex = questions.findIndex(q => q.id === questionId);
            if (questionIndex === -1) return;
            
            const question = questions[questionIndex];
            
            // Toggle upvote
            if (question.upvotedBy.includes(clientId)) {
                question.upvotes--;
                question.upvotedBy = question.upvotedBy.filter(id => id !== clientId);
                e.currentTarget.classList.remove('upvoted');
            } else {
                question.upvotes++;
                question.upvotedBy.push(clientId);
                e.currentTarget.classList.add('upvoted');
            }
            
            // Update the display
            e.currentTarget.querySelector('span').textContent = question.upvotes;
            
            // Save to localStorage
            saveQuestionsToLocalStorage();
        }

        // Get a unique client ID for tracking upvotes
        function getClientId() {
            let clientId = localStorage.getItem('amaClientId');
            if (!clientId) {
                clientId = 'client_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('amaClientId', clientId);
            }
            return clientId;
        }

        // Submit a new question
        function submitQuestion(e) {
            e.preventDefault();
            
            const title = document.getElementById('questionTitle').value.trim();
            const content = document.getElementById('questionContent').value.trim();
            const topic = document.getElementById('questionTopic').value;
            const submitter = document.getElementById('submitterName').value.trim() || 'Anonymous';
            const email = document.getElementById('submitterEmail').value.trim();
            
            if (!title || !content || !topic) {
                showToast('Please fill in all required fields.', 'error');
                return;
            }
            
            const newQuestion = {
                id: 'q' + Date.now(),
                title,
                content,
                topic,
                submitter,
                email,
                date: new Date().toISOString(),
                upvotes: 0,
                upvotedBy: [],
                response: '',
                responseDate: ''
            };
            
            // Add to questions array
            questions.unshift(newQuestion);
            
            // Save to localStorage
            saveQuestionsToLocalStorage();
            
            // Reset form
            document.getElementById('questionForm').reset();
            
            // Show success message
            showToast('Your question has been submitted successfully!', 'success');
            
            // Switch to questions tab
            showTab('tabAllQuestions');
            
            // Send email notification to admin
            const topicText = getTopicName(topic);
            const emailBody = `
                A new question has been submitted in the APAC Finance Leadership AMA portal:
                
                Title: ${title}
                Topic: ${topicText}
                Submitted by: ${submitter}
                
                Question: ${content}
                
                Please log in to the AMA portal to respond.
            `;
            
            sendEmail(
                adminEmail, 
                "New Question Submitted - APAC Finance Leadership AMA",
                emailBody,
                function(response) {
                    console.log("Email notification sent to admin:", response);
                    updateEmailStatus("Email notification sent to admin successfully");
                },
                function(error) {
                    console.error("Failed to send email notification to admin:", error);
                    updateEmailStatus("Email notification failed: " + error.message, true);
                    tryFallbackEmail(adminEmail, "New Question Submitted - APAC Finance Leadership AMA", emailBody);
                }
            );
        }

        // Submit a response to a question
        function submitResponse(e) {
            e.preventDefault();
            
            const questionId = document.getElementById('responseQuestionId').value;
            const response = document.getElementById('responseContent').value.trim();
            
            if (!response) {
                showToast('Please enter a response.', 'error');
                return;
            }
            
            const questionIndex = questions.findIndex(q => q.id === questionId);
            if (questionIndex === -1) return;
            
            const question = questions[questionIndex];
            const isNewResponse = !question.response;
            
            question.response = response;
            question.responseDate = new Date().toISOString();
            
            // Save to localStorage
            saveQuestionsToLocalStorage();
            
            // Close modal
            closeResponseModal();
            
            // Show success message
            showToast(isNewResponse ? 'Response submitted successfully!' : 'Response updated successfully!', 'success');
            
            // Update display
            displayQuestions();
            
            // Send email notification to the question submitter if they provided an email
            if (question.email) {
                const emailBody = `
                    Your question in the APAC Finance Leadership AMA portal has received a response:
                    
                    Your Question: ${question.title}
                    
                    Response: ${response}
                    
                    You can view the full response and other questions in the AMA portal.
                `;
                
                sendEmail(
                    question.email,
                    "Your APAC Finance Leadership AMA Question Has Been Answered",
                    emailBody,
                    function(response) {
                        console.log("Email notification sent to employee:", response);
                        updateEmailStatus("Email notification sent to employee successfully");
                    },
                    function(error) {
                        console.error("Failed to send email notification to employee:", error);
                        updateEmailStatus("Email notification failed: " + error.message, true);
                        tryFallbackEmail(question.email, "Your APAC Finance Leadership AMA Question Has Been Answered", emailBody);
                    }
                );
            }
        }

        // Submit a new leadership update
        function submitUpdate(e) {
            e.preventDefault();
            
            const title = document.getElementById('updateTitle').value.trim();
            const content = document.getElementById('updateContent').value.trim();
            
            if (!title || !content) {
                showToast('Please fill in all fields.', 'error');
                return;
            }
            
            const newUpdate = {
                id: 'u' + Date.now(),
                title,
                content,
                date: new Date().toISOString()
            };
            
            // Add to updates array
            leadershipUpdates.unshift(newUpdate);
            
            // Save to localStorage
            saveUpdatesToLocalStorage();
            
            // Reset form
            document.getElementById('updateForm').reset();
            
            // Close modal
            closeUpdateModal();
            
            // Show success message
            showToast('Leadership update published successfully!', 'success');
            
            // Update display
            displayLeadershipUpdates();
        }

        // Delete a question
        function deleteQuestion() {
            const questionId = document.getElementById('deleteQuestionId').value;
            
            questions = questions.filter(q => q.id !== questionId);
            
            // Save to localStorage
            saveQuestionsToLocalStorage();
            
            // Close modal
            closeDeleteModal();
            
            // Show success message
            showToast('Question deleted successfully.', 'success');
            
            // Update display
            displayQuestions();
        }

        // Send email using EmailJS
        function sendEmail(to, subject, body, onSuccess, onError) {
            // Update status while sending
            updateEmailStatus("Sending email...");
            
            // Prepare the email data
            const templateParams = {
                to_email: to,
                subject: subject,
                message: body
            };
            
            // Send the email using EmailJS
            emailjs.send(emailjsServiceId, emailjsTemplateId, templateParams)
                .then(function(response) {
                    console.log('Email sent successfully:', response);
                    if (onSuccess) onSuccess(response);
                })
                .catch(function(error) {
                    console.error('Email sending failed:', error);
                    if (onError) onError(error);
                });
        }

        // Try fallback email method using mailto
        function tryFallbackEmail(to, subject, body) {
            try {
                // Create a mailto link
                const mailtoLink = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                
                // Open the default email client
                window.open(mailtoLink, '_blank');
                
                showToast('Automatic email failed - opened your email client instead', 'warning');
                updateEmailStatus("Fallback email method initiated (using your email client)");
            } catch (error) {
                console.error('Fallback email method failed:', error);
                updateEmailStatus("All email methods failed. Please use manual email", true);
            }
        }

        // Test the email system
        function testEmailSystem() {
            updateEmailStatus("Testing email system...");
            
            sendEmail(
                adminEmail,
                "APAC Finance AMA - Email System Test",
                "This is a test email to verify that the notification system is working correctly.\n\nIf you received this, the email system is functioning properly.",
                function(response) {
                    console.log("Test email sent successfully:", response);
                    updateEmailStatus("Email system test successful!");
                    showToast('Test email sent successfully!', 'success');
                },
                function(error) {
                    console.error("Test email failed:", error);
                    updateEmailStatus("Email system test failed: " + error.message, true);
                    showToast('Test email failed. Check admin panel for details.', 'error');
                    
                    // Try fallback
                    tryFallbackEmail(
                        adminEmail,
                        "APAC Finance AMA - Email System Test",
                        "This is a test email to verify that the notification system is working correctly.\n\nIf you received this, the fallback email system is functioning."
                    );
                }
            );
        }

        // Update the email status indicator
        function updateEmailStatus(status, isError = false) {
            const statusElement = document.getElementById('emailStatus');
            const indicatorElement = document.getElementById('emailStatusIndicator');
            
            if (!statusElement || !indicatorElement) return;
            
            statusElement.textContent = status;
            
            if (isError) {
                indicatorElement.className = 'error-box';
                indicatorElement.innerHTML = `<p><i class="fas fa-exclamation-circle mr-2"></i>Email system status: <span id="emailStatus">${status}</span></p>`;
            } else {
                indicatorElement.className = 'info-box';
                indicatorElement.innerHTML = `<p><i class="fas fa-info-circle mr-2"></i>Email system status: <span id="emailStatus">${status}</span></p>`;
            }
        }

        // Helper function to get topic name from value
        function getTopicName(topicValue) {
            const topicMap = {
                'benefits': 'Employee Benefits',
                'compensation': 'Compensation',
                'strategy': 'Strategy & Direction',
                'others': 'Others'
            };
            return topicMap[topicValue] || topicValue;
        }

        // Setup accordion functionality
        function setupAccordion() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('i');
                    
                    // Toggle content visibility
                    content.classList.toggle('hidden');
                    
                    // Toggle icon
                    if (content.classList.contains('hidden')) {
                        icon.className = 'fas fa-chevron-down';
                    } else {
                        icon.className = 'fas fa-chevron-up';
                    }
                });
            });
        }

        // Tab navigation
        function showTab(tabId) {
            // Hide all content sections
            submitQuestionForm.style.display = 'none';
            adminPanel.style.display = 'none';
            questionsContainer.style.display = 'none';
            leadershipUpdatesContainer.style.display = 'none';
            document.getElementById('searchFilterBar').style.display = 'none';
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-active').forEach(tab => {
                tab.classList.remove('tab-active');
            });
            
            // Show appropriate content and mark tab as active
            if (tabId === 'tabSubmitQuestion') {
                submitQuestionForm.style.display = 'block';
                document.getElementById(tabId).classList.add('tab-active');
            } else if (tabId === 'tabLeadershipUpdates') {
                leadershipUpdatesContainer.style.display = 'block';
                document.getElementById(tabId).classList.add('tab-active');
                displayLeadershipUpdates();
            } else if (tabId === 'tabAdminPanel' && isAdmin) {
                adminPanel.style.display = 'block';
                document.getElementById(tabId).classList.add('tab-active');
            } else {
                // Default to all questions
                questionsContainer.style.display = 'block';
                document.getElementById('searchFilterBar').style.display = 'flex';
                document.getElementById('tabAllQuestions').classList.add('tab-active');
                displayQuestions();
            }
        }

        // Admin login
        function handleAdminLogin(e) {
            e.preventDefault();
            
            const password = document.getElementById('adminLoginPassword').value;
            const savedPassword = localStorage.getItem('amaAdminPassword') || defaultAdminPassword;
            
            if (password === savedPassword) {
                isAdmin = true;
                adminTabs.style.display = 'block';
                adminLoginBtn.style.display = 'none';
                adminLogoutBtn.style.display = 'inline-flex';
                closeAdminLoginModal();
                showToast('Admin login successful!', 'success');
                updateAdminUI();
            } else {
                showToast('Incorrect password. Please try again.', 'error');
            }
        }

        // Admin logout
        function handleAdminLogout() {
            isAdmin = false;
            adminLoginBtn.style.display = 'inline-flex';
            adminLogoutBtn.style.display = 'none';
            showToast('Logged out successfully', 'success');
            updateAdminUI();
            showTab('tabAllQuestions');
        }

        // Update admin password
        function updateAdminPassword() {
            const newPassword = document.getElementById('adminPassword').value.trim();
            
            if (!newPassword) {
                showToast('Please enter a new password.', 'error');
                return;
            }
            
            localStorage.setItem('amaAdminPassword', newPassword);
            document.getElementById('adminPassword').value = '';
            showToast('Admin password updated successfully!', 'success');
        }

        // Update admin UI elements
        function updateAdminUI() {
            if (isAdmin) {
                adminTabs.style.display = 'block';
                adminLoginBtn.style.display = 'none';
                adminLogoutBtn.style.display = 'inline-flex';
                document.querySelectorAll('.admin-controls').forEach(el => {
                    el.style.display = 'block';
                });
            } else {
                adminTabs.style.display = 'none';
                adminLoginBtn.style.display = 'inline-flex';
                adminLogoutBtn.style.display = 'none';
                document.querySelectorAll('.admin-controls').forEach(el => {
                    el.style.display = 'none';
                });
            }
            
            // Refresh the current tab view
            if (document.getElementById('tabAllQuestions').classList.contains('tab-active')) {
                displayQuestions();
            } else if (document.getElementById('tabLeadershipUpdates').classList.contains('tab-active')) {
                displayLeadershipUpdates();
            }
        }

        // Modal functions
        function openAdminLoginModal() {
            adminLoginModal.style.display = 'flex';
            document.getElementById('adminLoginPassword').value = '';
            document.getElementById('adminLoginPassword').focus();
        }

        function closeAdminLoginModal() {
            adminLoginModal.style.display = 'none';
        }

        function openResponseModal(e) {
            const questionId = e.currentTarget.getAttribute('data-id');
            const question = questions.find(q => q.id === questionId);
            
            if (!question) return;
            
            document.getElementById('responseQuestionId').value = questionId;
            document.getElementById('responseContent').value = question.response || '';
            
            const topicText = getTopicName(question.topic);
            
            document.getElementById('responseQuestionDetails').innerHTML = `
                <h3 class="text-xl font-bold mb-2">${escapeHtml(question.title)}</h3>
                <div class="flex items-center mb-2">
                    <span class="badge badge-${question.topic} mr-2">${topicText}</span>
                    <span class="text-gray-400 text-sm">
                        Asked by ${escapeHtml(question.submitter)}
                    </span>
                </div>
                <div class="whitespace-pre-line">${escapeHtml(question.content)}</div>
            `;
            
            // Update email info
            const emailInfoElement = document.getElementById('responseEmailInfo');
            const emailAddressElement = document.getElementById('responseEmailAddress');
            
            if (question.email) {
                emailInfoElement.className = 'mb-4 info-box';
                emailAddressElement.textContent = question.email;
            } else {
                emailInfoElement.className = 'mb-4 warning-box';
                emailAddressElement.textContent = 'No email provided (no notification will be sent)';
            }
            
            responseModal.style.display = 'flex';
            document.getElementById('responseContent').focus();
        }

        function closeResponseModal() {
            responseModal.style.display = 'none';
        }

        function openUpdateModal() {
            document.getElementById('updateForm').reset();
            updateModal.style.display = 'flex';
            document.getElementById('updateTitle').focus();
        }

        function closeUpdateModal() {
            updateModal.style.display = 'none';
        }

        function openDeleteModal(e) {
            const questionId = e.currentTarget.getAttribute('data-id');
            const question = questions.find(q => q.id === questionId);
            
            if (!question) return;
            
            document.getElementById('deleteQuestionId').value = questionId;
            
            document.getElementById('deleteQuestionDetails').innerHTML = `
                <h3 class="text-lg font-bold mb-1">${escapeHtml(question.title)}</h3>
                <div class="text-sm">Asked by ${escapeHtml(question.submitter)}</div>
            `;
            
            deleteModal.style.display = 'flex';
        }

        function closeDeleteModal() {
            deleteModal.style.display = 'none';
        }

        function openEmailPreviewModal() {
            emailPreviewModal.style.display = 'flex';
        }

        function closeEmailPreviewModal() {
            emailPreviewModal.style.display = 'none';
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toastElement = document.getElementById('toast');
            const messageElement = document.getElementById('toastMessage');
            
            messageElement.textContent = message;
            
            // Set color based on type
            if (type === 'error') {
                toastElement.classList.add('bg-red-800');
                toastElement.classList.remove('bg-green-800', 'bg-gray-800', 'bg-yellow-800');
            } else if (type === 'success') {
                toastElement.classList.add('bg-green-800');
                toastElement.classList.remove('bg-red-800', 'bg-gray-800', 'bg-yellow-800');
            } else if (type === 'warning') {
                toastElement.classList.add('bg-yellow-800');
                toastElement.classList.remove('bg-red-800', 'bg-green-800', 'bg-gray-800');
            } else {
                toastElement.classList.add('bg-gray-800');
                toastElement.classList.remove('bg-red-800', 'bg-green-800', 'bg-yellow-800');
            }
            
            // Show toast
            toastElement.classList.remove('translate-y-20', 'opacity-0');
            
            // Hide after 3 seconds
            setTimeout(() => {
                toastElement.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // HTML escape function for security
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Create and download the manual email links
        function setupManualEmailLinks() {
            // Admin notification email
            document.getElementById('manualAdminEmailLink').addEventListener('click', function(e) {
                e.preventDefault();
                
                const subject = "New Question Submitted - APAC Finance Leadership AMA";
                const body = "A new question has been submitted in the APAC Finance Leadership AMA portal.\n\nPlease log in to the AMA portal to view and respond.";
                
                window.open(`mailto:${adminEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
            });
            
            // Employee notification email
            document.getElementById('manualEmployeeEmailLink').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Show an input dialog for the email address
                const employeeEmail = prompt("Enter the employee's email address:");
                
                if (!employeeEmail) return;
                
                const subject = "Your APAC Finance Leadership AMA Question Has Been Answered";
                const body = "Your question in the APAC Finance Leadership AMA portal has received a response.\n\nPlease visit the AMA portal to view the answer.";
                
                window.open(`mailto:${employeeEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab navigation
            document.getElementById('tabAllQuestions').addEventListener('click', () => showTab('tabAllQuestions'));
            document.getElementById('tabLeadershipUpdates').addEventListener('click', () => showTab('tabLeadershipUpdates'));
            document.getElementById('tabSubmitQuestion').addEventListener('click', () => showTab('tabSubmitQuestion'));
            document.getElementById('tabAdminPanel')?.addEventListener('click', () => showTab('tabAdminPanel'));
            
            // Form submissions
            document.getElementById('questionForm').addEventListener('submit', submitQuestion);
            document.getElementById('responseForm').addEventListener('submit', submitResponse);
            document.getElementById('updateForm').addEventListener('submit', submitUpdate);
            document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
            
            // Admin functions
            document.getElementById('adminLoginBtn').addEventListener('click', openAdminLoginModal);
            document.getElementById('adminLogoutBtn').addEventListener('click', handleAdminLogout);
            document.getElementById('cancelAdminLogin').addEventListener('click', closeAdminLoginModal);
            document.getElementById('cancelResponse').addEventListener('click', closeResponseModal);
            document.getElementById('addUpdateBtn').addEventListener('click', openUpdateModal);
            document.getElementById('cancelUpdate').addEventListener('click', closeUpdateModal);
            document.getElementById('cancelDelete').addEventListener('click', closeDeleteModal);
            document.getElementById('confirmDelete').addEventListener('click', deleteQuestion);
            document.getElementById('saveAdminPassword').addEventListener('click', updateAdminPassword);
            
            // Email system
            document.getElementById('testEmailBtn').addEventListener('click', testEmailSystem);
            document.getElementById('viewEmailPreviewBtn').addEventListener('click', openEmailPreviewModal);
            document.getElementById('closeEmailPreview').addEventListener('click', closeEmailPreviewModal);
            
            // Setup manual email links
            setupManualEmailLinks();
            
            // Search and filter
            document.getElementById('searchInput').addEventListener('input', displayQuestions);
            document.getElementById('topicFilter').addEventListener('change', displayQuestions);
            document.getElementById('sortFilter').addEventListener('change', displayQuestions);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === adminLoginModal) {
                    closeAdminLoginModal();
                }
                if (e.target === responseModal) {
                    closeResponseModal();
                }
                if (e.target === updateModal) {
                    closeUpdateModal();
                }
                if (e.target === deleteModal) {
                    closeDeleteModal();
                }
                if (e.target === emailPreviewModal) {
                    closeEmailPreviewModal();
                }
            });
        }

        // Show All Questions tab by default
        showTab('tabAllQuestions');
    </script>
</body>
</html>
